{% extends 'base.html.twig' %}
{% block head %}
    <!-- =================== META =================== -->
    <meta property="og:url"                content="http://127.0.0.1:8000/single-blog/{{ article.id }}" />
    <meta property="og:type"               content="article" />
    <meta property="og:title"              content="{{ article.titre }}" />
    <meta property="og:description"        content="{{ article.decription }}" />
    <meta property="og:image"              content="{{ asset('/upload/images/'~article.media) }}" />
    <meta charset="UTF-8">
    <title>SPORTUN</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="shortcut icon" href="{{asset('Front/img/favicon.png')}}">
    <!-- =================== STYLE =================== -->
    {% block css %}
        <link rel="stylesheet" href="{{asset('Front/css/slick.min.css')}}">
        <link rel="stylesheet" href="{{asset('Front/css/bootstrap-grid.css')}}">
        <link rel="stylesheet" href="{{asset('Front/css/font-awesome.min.css')}}">
        <link rel="stylesheet" href="{{asset('Front/css/style.css')}}">
    {% endblock %}
{%endblock%}
{% block content %}
{#    <style>#}
{#        .star{#}
{#            font-size: 1.5rem;#}
{#        }#}
{#        .hover{#}
{#            color: yellow;#}
{#        }#}
{#    </style>#}
    <div id="fb-root"></div>
    <script>(function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));</script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!--===================== S-NEWS =====================-->
    <section class="s-news">
        <div id="fb-root"></div>
        <script async defer crossorigin="anonymous" src="https://connect.facebook.net/fr_FR/sdk/debug.js#xfbml=1&version=v13.0&appId=683212913114745&autoLogAppEvents=1" nonce="J1tpdd1I"></script>
        <script>
            window.fbAsyncInit = function() {
                FB.init({
                    appId            : '683212913114745',
                    autoLogAppEvents : true,
                    xfbml            : true,
                    version          : 'v13.0'

                });
            };
        </script>
        <script>
            document.getElementById('shareBtn').onclick = function() {
                FB.ui({
                    display: 'popup',
                    method: 'share',
                    href: 'http://127.0.0.1:8000/single-blog/{{ article.id }}',
                }, function(response){});
            }
        </script>

        <input type="hidden" value="{{ article.id }}" id="idarticle">
        <script>

            $(document).ready(function () {
                $(".btn").click(function(e)
                {e.preventDefault();
                    var formData  =$("#form").serialize(); //data mn formulaire
                    let idart = $("#idarticle").val();
                    // let user = $("#user").val();
                    var msg = $("#textid").val();
                    console.log(idart);
                    // let date = $("#nom").text();
                    $.ajax({
                        url:"http://127.0.0.1:8000/commentaire/add/"+msg+"/"+idart,
                        type:"post",
                        data:formData,
                        success:function(dataBack)
                        {
                        }, error: function (xhr, status, error)
                        {
                            console.log(error);
                        }
                    });
                    $('.hh').val("");
                    document.getElementById("textid").value = "";
                });
                //get Information for commentaire
                setInterval(function () {
                    let idarticle = $("#idarticle").val();
                    $.ajax({
                        url:"http://127.0.0.1:8000/commentaire/"+idarticle,
                        type: "get",
                        dataType: "json",
                        cache: false,
                        success: function (data , status) {
                            console.log(data)
                            let l = data.length;
                            console.log(l,"taille");
                            var MSG="";
                            for (let i =0; i < l; i++){
                                MSG +="<div class='review-item'>"+
                                        {#                                    <div class="review-avatar"><img src="{{ asset('Front/img/comments-photo-1.png') }}" alt="img"></div>#}
                                    "    <div class='review-content'>"+
                                           " <h6 class='name'>"+data[i].username+"</h6>"+
                                            {#                                        <div class="date"><i class="fa fa-calendar" aria-hidden="true"></i>Dec 26, 2019</div>#}
                                            "<p class='review-comment'>"+data[i].text+"</p>"+
                                            "<a class='review-btn' href='http://127.0.0.1:8000/updatecomment/"+data[i].id+"'><i class='fa fa-pencil-square-o' aria-hidden='true'></i> modifier</a>"+
                                            "<a class='review-btn' href='http://127.0.0.1:8000/suppcomnt/"+data[i].id+"'><i class='fa fa-times' aria-hidden='true'></i> supprimer</a>"+
                                        "</div>"+
                                    "</div>";
                            }
                            $("#listedecomment").html(MSG);
                        },
                        error: function (data) {
                            console.log("err",idarticle );
                        },
                    });
                },10000);
            });
        </script>

        <script src="{{ asset('https://unpkg.com/axios/dist/axios.min.js') }}"></script>
        <script>
            function onClickBtnLike(event) {
                event.preventDefault();
                const url = this.href;
                const spanCount = this.querySelector('span.js-likes');
                const  icone = this.querySelector('i');
                axios.get(url).then(function (response) {
                    spanCount.textContent=response.data.likes;
                    if (icone.classList.contains('fas')){
                        icone.classList.replace('fas','far');
                    }
                    else {
                        icone.classList.replace('far','fas');
                    }
                })
            }
            document.querySelectorAll('a.js-like').forEach(function(link){
                link.addEventListener('click',onClickBtnLike);
            })
        </script>
        <script>
            const stars =document.querySelectorAll('.star');
            let check = false;
            stars.forEach(star=>{
                star.addEventListener('mouseover',selectStars);
                star.addEventListener('mouseleave',unselectStars);

                star.addEventListener('click',activeSelect);



            })
            function selectStars(e){
                const data =e.target;
                const etoiles = priviousSiblings(data);
                if(!check){
                    etoiles.forEach(etoile=>{
                        etoile.classList.add('hover');
                    })
                }


            }
            function unselectStars(e){
                const data =e.target;
                const etoiles = priviousSiblings(data);
                if(!check){
                    etoiles.forEach(etoile=>{
                        etoile.classList.remove('hover');
                    })
                }

            }
            function priviousSiblings(data){
                let values=[data];
                while (data = data.previousSibling){
                    if(data.nodeName ==='I'){
                        values.push(data);
                    }
                }
                return values;
            }
            function  activeSelect(e){
                check=true;

                document.querySelector('.note').innerHTML='Note: '+ e.target.dataset.note;
            }
        </script>
        <div class="container">
            <div class="row">
                <div class="col-12 col-lg-9 blog-cover">
                    <div class="post-item-cover">
                        <div class="post-header">
                            <div class="post-thumbnail">
                                <img src="{{ asset('/upload/images/'~article.media) }}" alt="img">
                            </div>
                        </div>
                        <div class="post-content">
                            <div class="meta">
{#                                <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>{{ article.createdAt |date('d/m/y h:m') }}</span>#}
                                <span class="post-category"><i class="fa fa-tag" aria-hidden="true"></i><a href="#">{{ article.decription }}</a></span>
                            </div>
                            <h2 class="title">{{ article.titre }}</h2>
                            <div class="text">
                                <p>{{ article.text }}</p>
                            </div>
                        </div>
                        <div class="post-footer">
                            <div class="meta">
                                <span class="post-comment"><i class="fa fa-comment" aria-hidden="true"></i><a href="#">{{ commentaires | length  }} Comments(s)</a></span>
                                <div><i class="star" data-note="1">&#9733;</i>
<i class="star" data-note="2">&#9733;</i>
<i class="star" data-note="3">&#9733;</i>
<i class="star" data-note="4">&#9733;</i>
<i class="star" data-note="5">&#9733;</i>
<i class="note">Note:</i></div>

{#                                <a href="{{ path('PosteLike',{'id':i.id}) }}" class="btn btn-link js-like">#}

{#                                    {% if app.user and i.JaimePar(app.user) %}#}
{#                                        <div class="row">#}
{#                                            <div class="col-2">   <i class="fa fa-thumbs-up"></i></div>#}
{#                                            <div class="col-6">   <span class="js-label">je n'aime pas</span></div>#}
{#                                            <div class="col-2">   <span class="js-likes">{{ i.postLikes|length}}</span></div>#}

{#                                        </div>#}
{#                                    {% else %}#}
{#                                        <div class="row">#}
{#                                            <div class="col-2">#}
{#                                                <i class="fa fa-thumbs-up"></i></div>#}
{#                                            <div class="col-6">#}
{#                                                <span class="js-label">j'aime</span>#}
{#                                            </div>#}
{#                                            <div class="col-2">#}
{#                                                <span class="js-likes">{{ i.postLikes|length}}</span></div>#}
{#                                        </div>#}
{#                                    {% endif %}#}
{#                                </a>#}
{#                                <span class="post-tags"><i class="fa fa-hashtag" aria-hidden="true"></i><a href="#">Aenean</a><a href="#">Mattis</a></span>#}
{#                                <div id="shareBtn" class="btn btn-success clearfix">partage sur facebook</div>#}
{#                                <div class="fb-like" data-href="https://developers.facebook.com/docs/plugins/" data-width="" data-layout="standard" data-action="like" data-size="large" data-share="true">fb share</div>#}
{#                                <script src="{{asset('Front/js/jscommnt.js')}}">#}
{#                                </script>#}
{#                                <div><a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-show-count="false">Tweet</a>#}
{#                                    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div>#}
                                <div class="fb-share-button"
                                     data-href="http://127.0.0.1:8000/single-blog/{{ article.id }}"
                                     data-layout="button_count">
                                </div>
                                <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-show-count="false">Tweet</a>
                                <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
                                </a>
                            </div>
                        </div>
                    </div>
                    <!--=============== AUTOR-COVER ===============-->
                    <div class="autor-cover">
                        <img src="{{ asset('Front/img/autor-img.png') }}" alt="img">
                        <div class="autor-content">
                            <div class="name">Samson Peters</div>
                            <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem</p>
                        </div>
                    </div>
                    <!--============= AUTOR-COVER END =============-->
                    <div class="reviews">
                        <h2 class="title">Comments</h2>
                        <ul class="reviews-list">
                            <li class="item" id="listedecomment">
{#             hedhi awel comment                   #}
                                {#            hedhi end commente                    #}
                            </li>
                        </ul>
                        <div class="reviews-form">
                           {% block commentaire %}
                               {{ form_start(form,{'id':'form','attr':{'novalidate':'novalidate'}}) }}
                               <h1>Ajouter un article</h1>
                              <h2 class="title">Leave a Comment</h2>
                                   <ul class="form-cover">
                                       <li class="inp-name">
                                           <label></label>
                                           {{ form_widget(form.username) }}
                                           {{ form_errors(form.username) }}
                                       </li>
                                       <li class="inp-email">
                                           <label>{{ form_label(form.text,"contenu du commentaire") }}</label>
                                           {{ form_errors(form.text) }}
                                           {{ form_widget(form.text,{'id':'textid'}) }}
                                       </li>
                                   </ul>
                                   <div class="btn-form-cover">
                                       {{ form_end(form) }}
                                   </div>
                            {% endblock %}
                        </div>
                    </div>
{#                    fb script#}

                    <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script>
{#end b script#}
                </div>
                <!--================= SIDEBAR =================-->
                <div class="col-12 col-lg-3 sidebar">
                    <a href="#" class="btn btn-sidebar"><span>Widgets</span></a>
                    <ul class="widgets">
                        <!--=========== WIDGET-SEARCH ===========-->
                        <li class="widget widget-search">
                            <h3 class="title">Search</h3>
                            <form class="search-form">
                                <input class="inp-form" type="text" name="search" id="search" placeholder="Search">
                                <button type="submit" class="btn-form"><i class="fa fa-search" aria-hidden="true"></i></button>
                            </form>
=                        </li>
                        <!--========= WIDGET-SEARCH END =========-->
                        <!--=========== WIDGET-ARHIVE ===========-->
                        <li class="widget widget-archive">
                            <h3 class="title">Archive</h3>
                            <ul>
                                <li><a href="#">January 2019</a></li>
                                <li><a href="#">February 2019</a></li>
                                <li><a href="#">March 2019</a></li>
                                <li><a href="#">April 2019</a></li>
                                <li><a href="#">May 2019</a></li>
                            </ul>
                        </li>
                        <!--========= WIDGET-ARHIVE END =========-->
                        <!--========= WIDGET-CATEGORIES =========-->
                        <li class="widget widget-categories">
                            <h3 class="title">Categories</h3>
                            <ul>
                                <li><a href="#">Training</a></li>
                                <li><a href="#">Courses</a></li>
                                <li><a href="#">Conferences</a></li>
                                <li><a href="#">Development</a></li>
                                <li><a href="#">UI/UX Designer</a></li>
                            </ul>
                        </li>
                        <!--======= WIDGET-CATEGORIES END =======-->
                        <!--======== WIDGET-RECENT-POSTS ========-->
                        <li class="widget widget-recent-posts">
                            <h3 class="title">Recent Blog Posts</h3>
                            <ul>
                                <li>
                                    <a href="#">Mobile App Design: From Beginner to Intermediate</a>
                                    <div class="date"><i class="fa fa-calendar" aria-hidden="true"></i>Dec 27, 2019 at 5:47 pm</div>
                                </li>
                                <li>
                                    <a href="#">Et harum quidem rerum facilis est et expedita distinctio</a>
                                    <div class="date"><i class="fa fa-calendar" aria-hidden="true"></i>Dec 17, 2018 at 5:47 pm</div>
                                </li>
                                <li>
                                    <a href="#">Nam libero tempore, cum soluta nobis est eligendi optio</a>
                                    <div class="date"><i class="fa fa-calendar" aria-hidden="true"></i>Dec 8, 2018 at 5:47 pm</div>
                                </li>
                            </ul>
                        </li>
                        <!--====== WIDGET-RECENT-POSTS END ======-->
                        <!--========== WIDGET-INSTAGRAM ==========-->
                        <li class="widget widget-instagram">
                            <h3 class="title">Instagram</h3>
                            <ul>
                                <li>
                                    <a href="#"><img src="{{ asset('Front/img/insta-widget-1.jpg') }}" alt="img"></a>
                                </li>
                                <li>
                                    <a href="#"><img src="{{ asset('Front/img/insta-widget-2.jpg') }}" alt="img"></a>
                                </li>
                                <li>
                                    <a href="#"><img src="{{ asset('Front/img/insta-widget-3.jpg') }}" alt="img"></a>
                                </li>
                                <li>
                                    <a href="#"><img src="{{ asset('Front/img/insta-widget-4.jpg') }}" alt="img"></a>
                                </li>
                                <li>
                                    <a href="#"><img src="{{ asset('Front/img/insta-widget-5.jpg') }}" alt="img"></a>
                                </li>
                                <li>
                                    <a href="#"><img src="{{ asset('Front/img/insta-widget-6.jpg') }}" alt="img"></a>
                                </li>
                            </ul>
                        </li>
                        <!--======== WIDGET-INSTAGRAM END ========-->
                    </ul>
                </div>
                <!--=============== SIDEBAR END ===============-->
            </div>
        </div>
    </section>
{% endblock %}